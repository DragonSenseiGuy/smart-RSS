<!DOCTYPE html>
<html lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <title>Smart RSS</title>

    <style>
        .custom-theme #center-div {
            background-color: ;
            color: ;
        }
        .custom-theme #nav-bar {
            background-color: ;
        }
        .custom-theme .nav-bar-links {
            color: ;
            text-decoration: none;
        }
        .custom-theme .homepage-links {
            color: ;
        }
    </style>

</head>
<body class="custom-theme">
    <div>
        <div id="center-div">
            <div id="nav-bar">
    <div style="padding-left: 21px; padding-right: 21px; display: flex; justify-content: space-between; align-items: center;">
        <h2 style="width: 130px; margin: 0;"><a href="../index.html" class="nav-bar-links">RSS Feed</a></h2>
        <a href="../settings.html" style="text-align: right;" class="nav-bar-links">settings</a>
    </div>
</div>
            <div style="background-color: #f6f6ef; overflow: auto; padding-left: 20px; padding-right: 20px; padding-bottom: 20px; padding-top: 5px;">
                <h1 style="padding-left: 20px;">How I automate my Substack newsletter with content from my blog </a></h1>
                <p>I sent out <a href="https://simonw.substack.com/p/trying-out-gemini-3-pro-with-audio">my weekly-ish Substack newsletter</a> this morning and took the opportunity to record <a href="https://www.youtube.com/watch?v=BoPZltKDM-s">a YouTube video</a> demonstrating my process and describing the different components that make it work. There's a <em>lot</em> of digital duct tape involved, taking the content from Django+Heroku+PostgreSQL to GitHub Actions to SQLite+Datasette+Fly.io to JavaScript+Observable and finally to Substack.</p>

<p> </p>

<p>The core process is the same as I described <a href="https://simonwillison.net/2023/Apr/4/substack-observable/">back in 2023</a>. I have an Observable notebook called <a href="https://observablehq.com/@simonw/blog-to-newsletter">blog-to-newsletter</a> which fetches content from my blog's database, filters out anything that has been in the newsletter before, formats what's left as HTML and offers a big "Copy rich text newsletter to clipboard" button.</p>
<p><img alt="Screenshot of the interface. An item in a list says 9080: Trying out Gemini 3 Pro with audio transcription and a new pelican benchmark. A huge button reads Copy rich text newsletter to clipboard - below is a smaller button that says Copy just the links/quotes/TILs. A Last X days slider is set to 2. There are checkboxes for SKip content sent in prior newsletters and only include post content prior to the cutoff comment." src="https://static.simonwillison.net/static/2025/copy-to-newsletter.jpg" /></p>
<p>I click that button, paste the result into the Substack editor, tweak a few things and hit send. The whole process usually takes just a few minutes.</p>
<p>I make very minor edits:</p>
<ul>
<li>I set the title and the subheading for the newsletter. This is often a direct copy of the title of the featured blog post.</li>
<li>Substack turns YouTube URLs into embeds, which often isn't what I want - especially if I have a YouTube URL inside a code example.</li>
<li>Blocks of preformatted text often have an extra blank line at the end, which I remove.</li>
<li>Occasionally I'll make a content edit - removing a piece of content that doesn't fit the newsletter, or fixing a time reference like "yesterday" that doesn't make sense any more.</li>
<li>I pick the featured image for the newsletter and add some tags.</li>
</ul>
<p>That's the whole process!</p>
<h4 id="the-observable-notebook">The Observable notebook</h4>
<p>The most important cell in the Observable notebook is this one:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-s1">raw_content</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
  <span class="pl-c1">return</span> <span class="pl-s1">await</span> <span class="pl-kos">(</span>
    <span class="pl-k">await</span> <span class="pl-en">fetch</span><span class="pl-kos">(</span>
      <span class="pl-s">`https://datasette.simonwillison.net/simonwillisonblog.json?sql=<span class="pl-s1"><span class="pl-kos">${</span><span class="pl-en">encodeURIComponent</span><span class="pl-kos">(</span></span></span>
<span class="pl-s"><span class="pl-s1">        <span class="pl-s1">sql</span></span></span>
<span class="pl-s"><span class="pl-s1">      <span class="pl-kos">)</span><span class="pl-kos">}</span></span>&amp;_shape=array&amp;numdays=<span class="pl-s1"><span class="pl-kos">${</span><span class="pl-s1">numDays</span><span class="pl-kos">}</span></span>`</span>
    <span class="pl-kos">)</span>
  <span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-en">json</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
<span class="pl-kos">}</span></pre></div>
<p>This uses the JavaScript <code>fetch()</code> function to pull data from my blog's Datasette instance, using a very complex SQL query that is composed elsewhere in the notebook.</p>
<p>Here's a link to <a href="https://datasette.simonwillison.net/simonwillisonblog?sql=with+content+as+%28%0D%0A++select%0D%0A++++id%2C%0D%0A++++%27entry%27+as+type%2C%0D%0A++++title%2C%0D%0A++++created%2C%0D%0A++++slug%2C%0D%0A++++%27%3Ch3%3E%3Ca+href%3D%22%27+%7C%7C+%27https%3A%2F%2Fsimonwillison.net%2F%27+%7C%7C+strftime%28%27%25Y%2F%27%2C+created%29%0D%0A++++++%7C%7C+substr%28%27JanFebMarAprMayJunJulAugSepOctNovDec%27%2C+%28strftime%28%27%25m%27%2C+created%29+-+1%29+*+3+%2B+1%2C+3%29+%0D%0A++++++%7C%7C+%27%2F%27+%7C%7C+cast%28strftime%28%27%25d%27%2C+created%29+as+integer%29+%7C%7C+%27%2F%27+%7C%7C+slug+%7C%7C+%27%2F%27+%7C%7C+%27%22%3E%27+%0D%0A++++++%7C%7C+title+%7C%7C+%27%3C%2Fa%3E+-+%27+%7C%7C+date%28created%29+%7C%7C+%27%3C%2Fh3%3E%27+%7C%7C+body%0D%0A++++++as+html%2C%0D%0A++++%27null%27+as+json%2C%0D%0A++++%27%27+as+external_url%0D%0A++from+blog_entry%0D%0A++union+all%0D%0A++select%0D%0A++++id%2C%0D%0A++++%27blogmark%27+as+type%2C%0D%0A++++link_title%2C%0D%0A++++created%2C%0D%0A++++slug%2C%0D%0A++++%27%3Cp%3E%3Cstrong%3ELink%3C%2Fstrong%3E+%27+%7C%7C+date%28created%29+%7C%7C+%27+%3Ca+href%3D%22%27%7C%7C+link_url+%7C%7C+%27%22%3E%27%0D%0A++++++%7C%7C+link_title+%7C%7C+%27%3C%2Fa%3E%3A%3C%2Fp%3E%3Cp%3E%27+%7C%7C+%27+%27+%7C%7C+replace%28commentary%2C+%27%0D%0A%27%2C+%27%3Cbr%3E%27%29+%7C%7C+%27%3C%2Fp%3E%27%0D%0A++++++as+html%2C%0D%0A++++json_object%28%0D%0A++++++%27created%27%2C+date%28created%29%2C%0D%0A++++++%27link_url%27%2C+link_url%2C%0D%0A++++++%27link_title%27%2C+link_title%2C%0D%0A++++++%27commentary%27%2C+commentary%2C%0D%0A++++++%27use_markdown%27%2C+use_markdown%0D%0A++++%29+as+json%2C%0D%0A++link_url+as+external_url%0D%0A++from+blog_blogmark%0D%0A++union+all%0D%0A++select%0D%0A++++id%2C%0D%0A++++%27quotation%27+as+type%2C%0D%0A++++source%2C%0D%0A++++created%2C%0D%0A++++slug%2C%0D%0A++++%27%3Cstrong%3Equote%3C%2Fstrong%3E+%27+%7C%7C+date%28created%29+%7C%7C%0D%0A++++%27%3Cblockquote%3E%3Cp%3E%3Cem%3E%27+%7C%7C%0D%0A++++replace%28quotation%2C+%27%0D%0A%27%2C+%27%3Cbr%3E%27%29+%7C%7C+%0D%0A++++%27%3C%2Fem%3E%3C%2Fp%3E%3C%2Fblockquote%3E%3Cp%3E%3Ca+href%3D%22%27+%7C%7C%0D%0A++++coalesce%28source_url%2C+%27%23%27%29+%7C%7C+%27%22%3E%27+%7C%7C+source+%7C%7C+%27%3C%2Fa%3E%27+%7C%7C%0D%0A++++case+%0D%0A++++++++when+nullif%28trim%28context%29%2C+%27%27%29+is+not+null+%0D%0A++++++++then+%27%2C+%27+%7C%7C+context+%0D%0A++++++++else+%27%27+%0D%0A++++end+%7C%7C%0D%0A++++%27%3C%2Fp%3E%27+as+html%2C%0D%0A++++%27null%27+as+json%2C%0D%0A++++source_url+as+external_url%0D%0A++from+blog_quotation%0D%0A++union+all%0D%0A++select%0D%0A++++id%2C%0D%0A++++%27note%27+as+type%2C%0D%0A++++case%0D%0A++++++when+title+is+not+null+and+title+%3C%3E+%27%27+then+title%0D%0A++++++else+%27Note+on+%27+%7C%7C+date%28created%29%0D%0A++++end%2C%0D%0A++++created%2C%0D%0A++++slug%2C%0D%0A++++%27No+HTML%27%2C%0D%0A++++json_object%28%0D%0A++++++%27created%27%2C+date%28created%29%2C%0D%0A++++++%27link_url%27%2C+%27https%3A%2F%2Fsimonwillison.net%2F%27+%7C%7C+strftime%28%27%25Y%2F%27%2C+created%29%0D%0A++++++%7C%7C+substr%28%27JanFebMarAprMayJunJulAugSepOctNovDec%27%2C+%28strftime%28%27%25m%27%2C+created%29+-+1%29+*+3+%2B+1%2C+3%29+%0D%0A++++++%7C%7C+%27%2F%27+%7C%7C+cast%28strftime%28%27%25d%27%2C+created%29+as+integer%29+%7C%7C+%27%2F%27+%7C%7C+slug+%7C%7C+%27%2F%27%2C%0D%0A++++++%27link_title%27%2C+%27%27%2C%0D%0A++++++%27commentary%27%2C+body%2C%0D%0A++++++%27use_markdown%27%2C+1%0D%0A++++%29%2C%0D%0A++++%27%27+as+external_url%0D%0A++from+blog_note%0D%0A++union+all%0D%0A++select%0D%0A++++rowid%2C%0D%0A++++%27til%27+as+type%2C%0D%0A++++title%2C%0D%0A++++created%2C%0D%0A++++%27null%27+as+slug%2C%0D%0A++++%27%3Cp%3E%3Cstrong%3ETIL%3C%2Fstrong%3E+%27+%7C%7C+date%28created%29+%7C%7C+%27+%3Ca+href%3D%22%27%7C%7C+%27https%3A%2F%2Ftil.simonwillison.net%2F%27+%7C%7C+topic+%7C%7C+%27%2F%27+%7C%7C+slug+%7C%7C+%27%22%3E%27+%7C%7C+title+%7C%7C+%27%3C%2Fa%3E%3A%27+%7C%7C+%27+%27+%7C%7C+substr%28html%2C+1%2C+instr%28html%2C+%27%3C%2Fp%3E%27%29+-+1%29+%7C%7C+%27+%26%238230%3B%3C%2Fp%3E%27+as+html%2C%0D%0A++++%27null%27+as+json%2C%0D%0A++++%27https%3A%2F%2Ftil.simonwillison.net%2F%27+%7C%7C+topic+%7C%7C+%27%2F%27+%7C%7C+slug+as+external_url%0D%0A++from+til%0D%0A%29%2C%0D%0Acollected+as+%28%0D%0A++select%0D%0A++++id%2C%0D%0A++++type%2C%0D%0A++++title%2C%0D%0A++++case%0D%0A++++++when+type+%3D+%27til%27%0D%0A++++++then+external_url%0D%0A++++++else+%27https%3A%2F%2Fsimonwillison.net%2F%27+%7C%7C+strftime%28%27%25Y%2F%27%2C+created%29%0D%0A++++++%7C%7C+substr%28%27JanFebMarAprMayJunJulAugSepOctNovDec%27%2C+%28strftime%28%27%25m%27%2C+created%29+-+1%29+*+3+%2B+1%2C+3%29+%7C%7C+%0D%0A++++++%27%2F%27+%7C%7C+cast%28strftime%28%27%25d%27%2C+created%29+as+integer%29+%7C%7C+%27%2F%27+%7C%7C+slug+%7C%7C+%27%2F%27%0D%0A++++++end+as+url%2C%0D%0A++++created%2C%0D%0A++++html%2C%0D%0A++++json%2C%0D%0A++++external_url%2C%0D%0A++++case%0D%0A++++++when+type+%3D+%27entry%27+then+%28%0D%0A++++++++select+json_group_array%28tag%29%0D%0A++++++++from+blog_tag%0D%0A++++++++join+blog_entry_tags+on+blog_tag.id+%3D+blog_entry_tags.tag_id%0D%0A++++++++where+blog_entry_tags.entry_id+%3D+content.id%0D%0A++++++%29%0D%0A++++++when+type+%3D+%27blogmark%27+then+%28%0D%0A++++++++select+json_group_array%28tag%29%0D%0A++++++++from+blog_tag%0D%0A++++++++join+blog_blogmark_tags+on+blog_tag.id+%3D+blog_blogmark_tags.tag_id%0D%0A++++++++where+blog_blogmark_tags.blogmark_id+%3D+content.id%0D%0A++++++%29%0D%0A++++++when+type+%3D+%27quotation%27+then+%28%0D%0A++++++++select+json_group_array%28tag%29%0D%0A++++++++from+blog_tag%0D%0A++++++++join+blog_quotation_tags+on+blog_tag.id+%3D+blog_quotation_tags.tag_id%0D%0A++++++++where+blog_quotation_tags.quotation_id+%3D+content.id%0D%0A++++++%29%0D%0A++++++else+%27%5B%5D%27%0D%0A++++end+as+tags%0D%0A++from+content%0D%0A++where+created+%3E%3D+date%28%27now%27%2C+%27-%27+%7C%7C+%3Anumdays+%7C%7C+%27+days%27%29+++%0D%0A++order+by+created+desc%0D%0A%29%0D%0Aselect+id%2C+type%2C+title%2C+url%2C+created%2C+html%2C+json%2C+external_url%2C+tags%0D%0Afrom+collected+%0D%0Aorder+by+%0D%0A++case+type+%0D%0A++++when+%27entry%27+then+0+%0D%0A++++else+1+%0D%0A++end%2C%0D%0A++case+type+%0D%0A++++when+%27entry%27+then+created+%0D%0A++++else+-strftime%28%27%25s%27%2C+created%29+%0D%0A++end+desc%3B&amp;numdays=7">see and execute that query</a> directly in Datasette. It's 143 lines of convoluted SQL that assembles most of the HTML for the newsletter using SQLite string concatenation! An illustrative snippet:</p>
<div class="highlight highlight-source-sql"><pre>with content <span class="pl-k">as</span> (
  <span class="pl-k">select</span>
    id,
    <span class="pl-s"><span class="pl-pds">'</span>entry<span class="pl-pds">'</span></span> <span class="pl-k">as</span> type,
    title,
    created,
    slug,
    <span class="pl-s"><span class="pl-pds">'</span>&lt;h3&gt;&lt;a href="<span class="pl-pds">'</span></span> <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">'</span>https://simonwillison.net/<span class="pl-pds">'</span></span> <span class="pl-k">||</span> strftime(<span class="pl-s"><span class="pl-pds">'</span>%Y/<span class="pl-pds">'</span></span>, created)
      <span class="pl-k">||</span> substr(<span class="pl-s"><span class="pl-pds">'</span>JanFebMarAprMayJunJulAugSepOctNovDec<span class="pl-pds">'</span></span>, (strftime(<span class="pl-s"><span class="pl-pds">'</span>%m<span class="pl-pds">'</span></span>, created) <span class="pl-k">-</span> <span class="pl-c1">1</span>) <span class="pl-k">*</span> <span class="pl-c1">3</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>, <span class="pl-c1">3</span>)
      <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span> <span class="pl-k">||</span> cast(strftime(<span class="pl-s"><span class="pl-pds">'</span>%d<span class="pl-pds">'</span></span>, created) <span class="pl-k">as</span> <span class="pl-k">integer</span>) <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span> <span class="pl-k">||</span> slug <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span> <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">'</span>"&gt;<span class="pl-pds">'</span></span>
      <span class="pl-k">||</span> title <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;/a&gt; - <span class="pl-pds">'</span></span> <span class="pl-k">||</span> <span class="pl-k">date</span>(created) <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;/h3&gt;<span class="pl-pds">'</span></span> <span class="pl-k">||</span> body
      <span class="pl-k">as</span> html,
    <span class="pl-s"><span class="pl-pds">'</span>null<span class="pl-pds">'</span></span> <span class="pl-k">as</span> json,
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span> <span class="pl-k">as</span> external_url
  <span class="pl-k">from</span> blog_entry
  <span class="pl-k">union all</span>
  <span class="pl-c"><span class="pl-c">#</span> ...</span></pre></div>
<p>My blog's URLs look like <code>/2025/Nov/18/gemini-3/</code> - this SQL constructs that three letter month abbreviation from the month number using a substring operation.</p>
<p>This is a <em>terrible</em> way to assemble HTML, but I've stuck with it because it amuses me.</p>
<p>The rest of the Observable notebook takes that data, filters out anything that links to content mentioned in the previous newsletters and composes it into a block of HTML that can be copied using that big button.</p>
<p>Here's the recipe it uses to turn HTML into rich text content on a clipboard suitable for Substack. I can't remember how I figured this out but it's very effective:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-v">Object</span><span class="pl-kos">.</span><span class="pl-en">assign</span><span class="pl-kos">(</span>
  <span class="pl-en">html</span><span class="pl-s">`<span class="pl-kos">&lt;</span><span class="pl-ent">button</span> <span class="pl-c1">style</span>="<span class="pl-s">font-size: 1.4em; padding: 0.3em 1em; font-weight: bold;</span>"<span class="pl-kos">&gt;</span>Copy rich text newsletter to clipboard`</span><span class="pl-kos">,</span>
  <span class="pl-kos">{</span>
    <span class="pl-en">onclick</span>: <span class="pl-kos">(</span><span class="pl-kos">)</span> <span class="pl-c1">=&gt;</span> <span class="pl-kos">{</span>
      <span class="pl-k">const</span> <span class="pl-s1">htmlContent</span> <span class="pl-c1">=</span> <span class="pl-s1">newsletterHTML</span><span class="pl-kos">;</span>
      <span class="pl-c">// Create a temporary element to hold the HTML content</span>
      <span class="pl-k">const</span> <span class="pl-s1">tempElement</span> <span class="pl-c1">=</span> <span class="pl-smi">document</span><span class="pl-kos">.</span><span class="pl-en">createElement</span><span class="pl-kos">(</span><span class="pl-s">"div"</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-s1">tempElement</span><span class="pl-kos">.</span><span class="pl-c1">innerHTML</span> <span class="pl-c1">=</span> <span class="pl-s1">htmlContent</span><span class="pl-kos">;</span>
      <span class="pl-smi">document</span><span class="pl-kos">.</span><span class="pl-c1">body</span><span class="pl-kos">.</span><span class="pl-en">appendChild</span><span class="pl-kos">(</span><span class="pl-s1">tempElement</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-c">// Select the HTML content</span>
      <span class="pl-k">const</span> <span class="pl-s1">range</span> <span class="pl-c1">=</span> <span class="pl-smi">document</span><span class="pl-kos">.</span><span class="pl-en">createRange</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-s1">range</span><span class="pl-kos">.</span><span class="pl-en">selectNode</span><span class="pl-kos">(</span><span class="pl-s1">tempElement</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-c">// Copy the selected HTML content to the clipboard</span>
      <span class="pl-k">const</span> <span class="pl-s1">selection</span> <span class="pl-c1">=</span> <span class="pl-smi">window</span><span class="pl-kos">.</span><span class="pl-en">getSelection</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-s1">selection</span><span class="pl-kos">.</span><span class="pl-en">removeAllRanges</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-s1">selection</span><span class="pl-kos">.</span><span class="pl-en">addRange</span><span class="pl-kos">(</span><span class="pl-s1">range</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-smi">document</span><span class="pl-kos">.</span><span class="pl-en">execCommand</span><span class="pl-kos">(</span><span class="pl-s">"copy"</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-s1">selection</span><span class="pl-kos">.</span><span class="pl-en">removeAllRanges</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
      <span class="pl-smi">document</span><span class="pl-kos">.</span><span class="pl-c1">body</span><span class="pl-kos">.</span><span class="pl-en">removeChild</span><span class="pl-kos">(</span><span class="pl-s1">tempElement</span><span class="pl-kos">)</span><span class="pl-kos">;</span>
    <span class="pl-kos">}</span>
  <span class="pl-kos">}</span>
<span class="pl-kos">)</span></pre></div>
<h4 id="from-django-postgresql-to-datasette-sqlite">From Django+Postgresql to Datasette+SQLite</h4>
<p>My blog itself is a Django application hosted on Heroku, with data stored in Heroku PostgreSQL. Here's <a href="https://github.com/simonw/simonwillisonblog">the source code for that Django application</a>. I use the Django admin as my CMS.</p>
<p><a href="https://datasette.io/">Datasette</a> provides a JSON API over a SQLite database... which means something needs to convert that PostgreSQL database into a SQLite database that Datasette can use.</p>
<p>My system for doing that lives in the <a href="https://github.com/simonw/simonwillisonblog-backup">simonw/simonwillisonblog-backup</a> GitHub repository. It uses GitHub Actions on a schedule that executes every two hours, fetching the latest data from PostgreSQL and converting that to SQLite.</p>
<p>My <a href="https://github.com/simonw/db-to-sqlite">db-to-sqlite</a> tool is responsible for that conversion. I call it <a href="https://github.com/simonw/simonwillisonblog-backup/blob/dc5b9df272134ce051a5280b4de6d4daa9b2a9fc/.github/workflows/backup.yml#L44-L62">like this</a>:</p>
<div class="highlight highlight-source-shell"><pre>db-to-sqlite \
  <span class="pl-s"><span class="pl-pds">$(</span>heroku config:get DATABASE_URL -a simonwillisonblog <span class="pl-k">|</span> sed s/postgres:/postgresql+psycopg2:/<span class="pl-pds">)</span></span> \
  simonwillisonblog.db \
  --table auth_permission \
  --table auth_user \
  --table blog_blogmark \
  --table blog_blogmark_tags \
  --table blog_entry \
  --table blog_entry_tags \
  --table blog_quotation \
  --table blog_quotation_tags \
  --table blog_note \
  --table blog_note_tags \
  --table blog_tag \
  --table blog_previoustagname \
  --table blog_series \
  --table django_content_type \
  --table redirects_redirect</pre></div>
<p>That <code>heroku config:get DATABASE_URL</code> command uses Heroku credentials in an environment variable to fetch the database connection URL for my blog's PostgreSQL database (and fixes a small difference in the URL scheme).</p>
<p><code>db-to-sqlite</code> can then export that data and write it to a SQLite database file called <code>simonwillisonblog.db</code>.</p>
<p>The <code>--table</code> options specify the tables that should be included in the export.</p>
<p>The repository does more than just that conversion: it also exports the resulting data to JSON files that live in the repository, which gives me a <a href="https://github.com/simonw/simonwillisonblog-backup/commits/main/simonwillisonblog">commit history</a> of changes I make to my content. This is a cheap way to get a revision history of my blog content without having to mess around with detailed history tracking inside the Django application itself.</p>
<p>At the <a href="https://github.com/simonw/simonwillisonblog-backup/blob/dc5b9df272134ce051a5280b4de6d4daa9b2a9fc/.github/workflows/backup.yml#L200-L204">end of my GitHub Actions workflow</a> is this code that publishes the resulting database to Datasette running on <a href="https://fly.io/">Fly.io</a> using the <a href="https://datasette.io/plugins/datasette-publish-fly">datasette publish fly</a> plugin:</p>
<div class="highlight highlight-source-shell"><pre>datasette publish fly simonwillisonblog.db \
  -m metadata.yml \
  --app simonwillisonblog-backup \
  --branch 1.0a2 \
  --extra-options <span class="pl-s"><span class="pl-pds">"</span>--setting sql_time_limit_ms 15000 --setting truncate_cells_html 10000 --setting allow_facet off<span class="pl-pds">"</span></span> \
  --install datasette-block-robots \
  <span class="pl-c"><span class="pl-c">#</span> ... more plugins</span></pre></div>
<p>As you can see, there are a lot of moving parts! Surprisingly it all mostly just works - I rarely have to intervene in the process, and the cost of those different components is pleasantly low.</p>

        <p>Tags: <a href="https://simonwillison.net/tags/blogging">blogging</a>, <a href="https://simonwillison.net/tags/django">django</a>, <a href="https://simonwillison.net/tags/javascript">javascript</a>, <a href="https://simonwillison.net/tags/postgresql">postgresql</a>, <a href="https://simonwillison.net/tags/sql">sql</a>, <a href="https://simonwillison.net/tags/sqlite">sqlite</a>, <a href="https://simonwillison.net/tags/youtube">youtube</a>, <a href="https://simonwillison.net/tags/heroku">heroku</a>, <a href="https://simonwillison.net/tags/datasette">datasette</a>, <a href="https://simonwillison.net/tags/observable">observable</a>, <a href="https://simonwillison.net/tags/github-actions">github-actions</a>, <a href="https://simonwillison.net/tags/fly">fly</a>, <a href="https://simonwillison.net/tags/newsletter">newsletter</a></p>
            </div>
        </div>
    </div>
</body>
</html>